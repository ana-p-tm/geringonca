<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GERINGONÇA CLOUD</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

    <style>
        body { background-color: #f1f5f9; font-family: 'Inter', sans-serif; }
        .card-solid { background: white; border-radius: 1.25rem; border: 1px solid #e2e8f0; padding: 1.5rem; }
        .btn-emerald { background-color: #059669; color: white; font-weight: 700; }
        .active-chip { background-color: #059669 !important; color: white !important; }
    </style>
</head>
<body x-data="app()" x-init="init()" class="p-4 md:p-10">

    <h1 class="text-4xl font-black text-[#064e3b] tracking-tighter uppercase mb-10 text-center">GERINGONÇA <span class="text-xs bg-emerald-100 px-2 py-1 rounded text-emerald-700">CLOUD</span></h1>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-5xl mx-auto">
        
        <div class="card-solid shadow-lg border-2 border-emerald-50">
            <h3 class="font-bold mb-6 uppercase text-sm tracking-widest"><i class="fas fa-plus-circle"></i> Novo Gasto</h3>
            <div class="space-y-4">
                <input type="text" x-model="form.desc" class="w-full border p-3 rounded-xl" placeholder="O que foi?">
                <div class="relative">
                    <span class="absolute left-4 top-3.5 font-bold text-emerald-600">R$</span>
                    <input type="number" x-model="form.amount" class="w-full border p-3 pl-12 rounded-xl text-xl font-bold" placeholder="0.00">
                </div>
                <select x-model="form.payer" class="w-full border p-3 rounded-xl font-semibold">
                    <template x-for="p in people"><option :value="p" x-text="p"></option></template>
                </select>
                <div class="flex flex-wrap gap-2">
                    <template x-for="p in people">
                        <button @click="toggleInv(p)" :class="form.involved.includes(p) ? 'active-chip' : 'bg-slate-100 text-slate-400'" class="px-3 py-2 rounded-xl text-xs font-bold" x-text="p"></button>
                    </template>
                </div>
                <button @click="saveT()" class="w-full btn-emerald py-4 rounded-xl">REGISTAR NA NUVEM</button>
            </div>
        </div>

        <div class="card-solid border-t-4 border-t-emerald-600">
            <h3 class="font-bold mb-6 uppercase text-xs tracking-widest text-slate-400">Quem deve a quem</h3>
            <div class="space-y-4">
                <template x-for="p in balances">
                    <div class="flex justify-between items-center border-b pb-2">
                        <span class="font-bold text-slate-700" x-text="p.name"></span>
                        <span class="font-black text-lg" :class="p.val >= 0 ? 'text-emerald-600' : 'text-orange-500'" x-text="formatMoney(p.val)"></span>
                    </div>
                </template>
            </div>
        </div>

        <div class="lg:col-span-2 card-solid">
             <h3 class="font-bold mb-4 uppercase text-xs">Histórico em Tempo Real</h3>
             <div class="space-y-2 max-h-60 overflow-y-auto">
                <template x-for="t in transactions">
                    <div class="text-xs p-3 bg-slate-50 rounded-lg flex justify-between group">
                        <span><b x-text="t.payer"></b> pagou <b x-text="formatMoney(t.amount)"></b> em <span x-text="t.desc"></span></span>
                        <button @click="deleteT(t.id)" class="text-red-300 hover:text-red-500 opacity-0 group-hover:opacity-100">Apagar</button>
                    </div>
                </template>
             </div>
        </div>
    </div>

    <script>
        // CONFIGURAÇÃO DO FIREBASE (SUBSTITUI PELOS TEUS DADOS AQUI!)
        const firebaseConfig = {
           apiKey: "AIzaSyAngE5jObRFj2PU21JJ5lSFIqGHJLsxYvI",
  authDomain: "geringonca-53f0e.firebaseapp.com",
  databaseURL: "https://geringonca-53f0e-default-rtdb.firebaseio.com",
  projectId: "geringonca-53f0e",
  storageBucket: "geringonca-53f0e.firebasestorage.app",
  messagingSenderId: "42504617040",
  appId: "1:42504617040:web:a5ee3fe5530c54e5be2555",
  measurementId: "G-X0DN13KHEE"

        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        function app() {
            return {
                people: ["Tu", "Amigo 1", "Amigo 2"], // Podes editar aqui os nomes fixos do grupo
                transactions: [],
                balances: [],
                form: { desc: '', amount: '', payer: 'Tu', involved: ["Tu", "Amigo 1", "Amigo 2"] },

                init() {
                    // Escuta mudanças no banco de dados e atualiza o site na hora para todos!
                    db.ref('transacoes').on('value', (snapshot) => {
                        const data = snapshot.val();
                        this.transactions = data ? Object.values(data).reverse() : [];
                        this.calculate();
                    });
                },

                toggleInv(p) { this.form.involved.includes(p) ? this.form.involved = this.form.involved.filter(n => n !== p) : this.form.involved.push(p); },

                saveT() {
                    if(!this.form.desc || !this.form.amount) return alert('Preenche tudo!');
                    const newRef = db.ref('transacoes').push();
                    newRef.set({
                        id: newRef.key,
                        desc: this.form.desc,
                        amount: parseFloat(this.form.amount),
                        payer: this.form.payer,
                        involved: this.form.involved
                    });
                    this.form.desc = ''; this.form.amount = '';
                },

                deleteT(id) { if(confirm('Apagar?')) db.ref('transacoes/' + id).remove(); },

                calculate() {
                    let b = {}; this.people.forEach(p => b[p] = 0);
                    this.transactions.forEach(t => {
                        const share = t.amount / t.involved.length;
                        b[t.payer] += t.amount;
                        t.involved.forEach(p => b[p] -= share);
                    });
                    this.balances = Object.keys(b).map(n => ({ name: n, val: b[n] }));
                },

                formatMoney(v) { return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v); }
            }
        }
    </script>
</body>
</html>